<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economic Simulation</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 引入Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">

    <!-- 引入外部CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- 引入 jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- 引入 Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- 引入 Bootstrap JS（确保在 jQuery 之后加载） -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>

<body>
    <div>
        <h1>ADJUST THE SIMULATION PARAMETERS</h1>
        <form id="simulationForm">
            <label for="t_max">Simulation Year:</label>
            <input type="number" id="t_max" name="t_max" value="50" min="1" required><br>

            <label for="m_sim">Simulated Path:</label>
            <input type="number" id="m_sim" name="m_sim" value="100" min="1" required><br>

            <!-- 新增工资水平输入框 -->
            <label for="current_salary">Current Annual Salary:</label>
            <input type="number" id="current_salary" name="current_salary" value="150000" min="0" step="0.01" required><br>

            <!-- 新增总资产输入框 -->
            <label for="current_assets">Current Total Assets:</label>
            <input type="number" id="current_assets" name="current_assets" value="500000" min="0" step="0.01" required><br>

            <button type="submit" class="btn btn-primary">Run Simulation</button>
        </form>
    </div>

    <!-- 弹窗模态框 -->
    <div class="modal" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <!-- 弹窗标题 -->
                <div class="modal-header d-flex justify-content-between align-items-center">
                    <h3 class="modal-title mb-0" id="confirmModalLabel" style="white-space: nowrap;">Confirm Information</h3>
                </div>
                <!-- 弹窗内容 -->
                <div class="modal-body text-center">
                    <p class="mb-4">Please confirm the simulation parameters:</p>

                    <!-- 参数展示 -->
                    <div class="d-flex justify-content-center mb-2">
                        <strong class="mr-2">Simulation Year:</strong>
                        <span id="t_max_value"></span>
                    </div>
                    <div class="d-flex justify-content-center">
                        <strong class="mr-2">Number of Simulated Paths:</strong>
                        <span id="m_sim_value"></span>
                    </div>
                    <div class="d-flex justify-content-center">
                        <strong class="mr-2">Annual Salary:</strong>
                        <span id="current_salary_value"></span>
                    </div>
                    <div class="d-flex justify-content-center">
                        <strong class="mr-2">Total Assets:</strong>
                        <span id="current_assets_value"></span>
                    </div>
                </div>
                <!-- 弹窗底部按钮 -->
                <div class="modal-footer justify-content-center">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmButton">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 表单提交事件绑定
        $('#simulationForm').on('submit', function(event) {
            event.preventDefault(); // 阻止表单默认提交行为

            // 获取表单中用户输入的值
            var t_max = $('#t_max').val();
            var m_sim = $('#m_sim').val();
            var current_salary = $('#current_salary').val();
            var current_assets = $('#current_assets').val();

            // 将参数值插入到弹窗中的相应位置
            $('#t_max_value').text(t_max);
            $('#m_sim_value').text(m_sim);
            $('#current_salary_value').text(current_salary);
            $('#current_assets_value').text(current_assets);

            // 显示弹窗，等待用户确认
            $('#confirmModal').modal('show');
        });

        // 确认按钮点击事件绑定
        $('#confirmButton').on('click', function() {
            // 获取表单数据
            var t_max = $('#t_max').val();
            var m_sim = $('#m_sim').val();
            var current_salary = $('#current_salary').val();
            var current_assets = $('#current_assets').val();

            // 通过 AJAX 将数据发送到后端
            $.ajax({
                url: '/save_session', // 后端的路由
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    t_max: t_max,
                    m_sim: m_sim,
                    current_salary: current_salary,
                    current_assets: current_assets
                }),
                success: function(response) {
                    if (response.status === 'success') {
                        // 跳转到目标页面
                        window.location.href = '/Inflation_Rate';
                    } else {
                        alert('Failed to save session data.');
                    }
                },
                error: function() {
                    alert('Error communicating with server.');
                }
            });
        });
    </script>
</body>

</html>


